<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>READY PLAYER SANTA™ – Mission 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      /* Palette unifiée */
      --bg-deep: #000000;
      --bg-dark: #020617;
      --bg-mid: #0f172a;
      --panel-base: #0a1628;
      --panel-overlay: rgba(15, 23, 42, 0.97);
      
      /* Couleurs thématiques */
      --primary: #7dd3fc;
      --primary-glow: rgba(125, 211, 252, 0.4);
      --accent: #f97373;
      --accent-glow: rgba(249, 115, 115, 0.35);
      --success: #22c55e;
      --text: #e5f3ff;
      --muted: #94a3b8;
      --muted-dark: #64748b;
      
      /* Typographie */
      --mono: "JetBrains Mono", "SF Mono", Menlo, Consolas, monospace;
      --sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      
      /* Espacements unifiés */
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 18px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      
      /* Transitions unifiées */
      --transition-fast: 0.2s ease-out;
      --transition-base: 0.35s ease-out;
      --transition-slow: 0.7s ease-out;
    }

    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--sans);
      background: radial-gradient(circle at top, var(--bg-mid) 0%, var(--bg-dark) 55%, var(--bg-deep) 100%);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      opacity: 1;
      transition: opacity var(--transition-base);
    }

    body.page-exit {
      opacity: 0;
    }

    /* Scanlines CRT globales */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.02) 0px,
        rgba(255, 255, 255, 0.02) 1px,
        transparent 2px,
        transparent 4px
      );
      mix-blend-mode: soft-light;
      opacity: 0.7;
      z-index: 10;
      animation: scanlineShift 8s linear infinite;
    }

    @keyframes scanlineShift {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(2px); }
    }

/* Effet neige HUD subtil AMÉLIORÉ */
body::after {
  content: "";
  position: fixed;
  top: -150%;    /* ← Déborde largement au-dessus */
  left: -150%;   /* ← Déborde largement à gauche */
  width: 400%;   /* ← 4x plus large */
  height: 400%;  /* ← 4x plus haut */
  pointer-events: none;
  background-image:
    radial-gradient(circle, rgba(148, 163, 184, 0.35) 0, transparent 50%),
    radial-gradient(circle, rgba(148, 163, 184, 0.25) 0, transparent 50%),
    radial-gradient(circle, rgba(148, 163, 184, 0.2) 0, transparent 50%);
  background-size: 180px 180px, 280px 280px, 360px 360px;
  background-position: 0 0, 140px 100px, 80px 200px;
  opacity: 0.14;
  mix-blend-mode: screen;
  animation: snowDrift 24s linear infinite;
  z-index: 5;
}

@keyframes snowDrift {
  0% { transform: translate3d(0, -100px, 0); }
  100% { transform: translate3d(-50px, 100px, 0); }
}

    /* Particules flottantes */
    .particles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--primary);
      border-radius: 50%;
      opacity: 0;
      animation: particleFloat 20s infinite ease-in-out;
      box-shadow: 0 0 8px var(--primary-glow);
      transition: opacity 0.3s ease-out;
    }

    @keyframes particleFloat {
      0% { transform: translate3d(0, -100px, 0); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.4; }
      100% { transform: translate3d(50px, 100vh, 0); opacity: 0; }
    }

    /* Glitch subtil */
    @keyframes softGlitch {
      0%, 100% { transform: translateY(0); filter: none; }
      45% { transform: translateY(0); filter: none; }
      50% { transform: translateY(-1px); filter: contrast(1.02) saturate(1.03); }
      52% { transform: translateY(1px); filter: contrast(1.04) saturate(1.05); }
      56% { transform: translateY(0); filter: none; }
    }

    /* Shake HUD */
    @keyframes hudShake {
      0% { transform: translate(0, 0); }
      20% { transform: translate(0.8px, -0.8px); }
      40% { transform: translate(-0.8px, 0.8px); }
      60% { transform: translate(0.8px, 0.8px); }
      80% { transform: translate(-0.8px, -0.8px); }
      100% { transform: translate(0, 0); }
    }

    /* ===== LOADING SCREEN ULTRA ===== */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, var(--bg-dark) 0%, var(--bg-deep) 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      color: var(--text);
      animation: softGlitch 4s infinite ease-in-out alternate;
    }

    .loading-inner {
      text-align: center;
      max-width: 460px;
      padding: var(--spacing-xl) var(--spacing-lg);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background:
        radial-gradient(circle at top, var(--primary-glow), transparent 65%),
        radial-gradient(circle at bottom, var(--panel-overlay), rgba(2, 6, 23, 0.98));
      box-shadow:
        0 0 40px rgba(15, 23, 42, 0.95),
        0 0 60px rgba(56, 189, 248, 0.35),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
    }

    .loading-inner::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 10% 0%, var(--primary-glow), transparent 60%),
        radial-gradient(circle at 90% 100%, var(--accent-glow), transparent 60%);
      opacity: 0.85;
      pointer-events: none;
      mix-blend-mode: screen;
      animation: loadingPulse 3s ease-in-out infinite;
    }

    @keyframes loadingPulse {
      0%, 100% { opacity: 0.85; }
      50% { opacity: 1; }
    }

    .loading-title {
      font-family: var(--mono);
      font-size: 0.85rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: var(--spacing-md);
    }

    .loading-logo {
      font-family: var(--mono);
      font-size: 0.8rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--primary);
      margin-bottom: var(--spacing-lg);
      text-shadow: 0 0 20px var(--primary-glow);
    }

    .loading-main {
      font-size: 1rem;
      line-height: 1.5;
      margin-bottom: var(--spacing-lg);
    }

    .loading-main span {
      color: var(--primary);
      font-weight: 600;
    }

    .boot-sequence {
      margin-top: var(--spacing-md);
      text-align: left;
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--muted-dark);
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
    }

    .boot-line {
      margin-bottom: 6px;
      opacity: 0;
      transform: translateX(-10px);
      animation: bootLine 0.4s ease-out forwards;
    }

    .boot-line:nth-child(1) { animation-delay: 0.3s; }
    .boot-line:nth-child(2) { animation-delay: 0.6s; }
    .boot-line:nth-child(3) { animation-delay: 0.9s; }

    @keyframes bootLine {
      0% { opacity: 0; transform: translateX(-10px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    .loading-bar {
      width: 100%;
      height: 8px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: var(--spacing-sm);
      margin-top: var(--spacing-lg);
      box-shadow: 
        0 0 0 1px rgba(148, 163, 184, 0.4),
        inset 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .loading-bar-fill {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, var(--primary), #38bdf8, var(--success));
      border-radius: inherit;
      box-shadow: 0 0 20px rgba(56, 189, 248, 0.9);
      transition: width 0.15s linear;
    }

    .loading-percent {
      font-family: var(--mono);
      font-size: 0.82rem;
      color: var(--muted);
      letter-spacing: 0.1em;
    }

    .loading-hint {
      margin-top: var(--spacing-md);
      font-size: 0.8rem;
      color: var(--muted-dark);
      font-style: italic;
      line-height: 1.4;
    }

    /* ===== MAIN CONTENT ===== */
    .shell {
      position: relative;
      max-width: 920px;
      margin: 72px auto 56px;
      padding: 0 var(--spacing-lg) 72px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity var(--transition-slow), transform var(--transition-slow);
      z-index: 2;
    }

    .shell.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .panel {
      width: 100%;
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background:
        radial-gradient(circle at top left, rgba(125, 211, 252, 0.08), transparent 65%),
        linear-gradient(145deg, var(--panel-overlay), rgba(15, 23, 42, 1));
      box-shadow:
        0 0 50px rgba(15, 23, 42, 1),
        0 28px 90px rgba(0, 0, 0, 0.95),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 0% 0%, var(--primary-glow), transparent 60%),
        radial-gradient(circle at 100% 100%, var(--accent-glow), transparent 60%);
      opacity: 0.5;
      pointer-events: none;
      mix-blend-mode: screen;
      animation: panelBreath 5s ease-in-out infinite;
    }

    @keyframes panelBreath {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.7; }
    }

    /* NOUVEAU: Grille HUD holographique */
    .panel::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(125, 211, 252, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(125, 211, 252, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      opacity: 0.4;
      z-index: 0;
      animation: gridPulse 8s ease-in-out infinite;
    }

    @keyframes gridPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.5; }
    }

    .panel-inner {
      position: relative;
      z-index: 1;
      padding: 28px 26px 26px;
    }

    .hud-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xs);
      font-family: var(--mono);
      font-size: 0.72rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .hud-pill {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.86);
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .hud-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--success), #15803d);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.85);
      animation: pulse 2.5s infinite ease-in-out;
    }

    @keyframes pulse {
      0%, 100% { 
        box-shadow: 0 0 12px rgba(34, 197, 94, 0.85); 
        transform: scale(1); 
      }
      50% { 
        box-shadow: 0 0 20px rgba(34, 197, 94, 1); 
        transform: scale(1.1); 
      }
    }

    .title {
      text-align: center;
      margin: var(--spacing-md) 0 var(--spacing-xs);
    }

    .title-main {
      font-family: var(--mono);
      font-size: 0.92rem;
      letter-spacing: 0.32em;
      text-transform: uppercase;
      color: var(--primary);
      margin-bottom: 6px;
      text-shadow: 0 0 25px var(--primary-glow);
    }

    .title-sub {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .separator {
      width: 100%;
      height: 1px;
      margin: var(--spacing-md) 0 var(--spacing-lg);
      background: linear-gradient(
        to right,
        transparent,
        rgba(148, 163, 184, 0.9),
        var(--primary-glow),
        rgba(148, 163, 184, 0.9),
        transparent
      );
      opacity: 0.75;
    }

    .story {
      font-family: var(--mono);
      font-size: 0.92rem;
      line-height: 1.75;
      color: var(--text);
      white-space: pre-wrap;
      margin-bottom: var(--spacing-lg);
      min-height: 320px;
      text-align: left;
      width: 100%;
      display: block;
    }

    #story-text {
      display: block;
      text-align: left;
      width: 100%;
    }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 16px;
      background: var(--primary);
      margin-left: 2px;
      animation: cursorBlink 1s steps(2) infinite;
      box-shadow: 0 0 8px var(--primary-glow);
    }

    @keyframes cursorBlink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .mission-panel {
      margin: var(--spacing-lg) 0;
      padding: var(--spacing-lg);
      border-radius: 14px;
      border: 1px solid rgba(125, 211, 252, 0.4);
      background:
        radial-gradient(circle at top, var(--primary-glow), transparent 80%),
        rgba(15, 23, 42, 0.7);
      box-shadow:
        0 0 30px rgba(56, 189, 248, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      position: relative;
      overflow: hidden;
    }

    /* NOUVEAU: Animation d'apparition du mission panel */
    .mission-panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(125, 211, 252, 0.1), transparent);
      transform: translateX(-100%);
      animation: missionSweep 1.5s ease-out 0.3s;
    }

    @keyframes missionSweep {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .mission-title {
      font-family: var(--mono);
      font-size: 0.88rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--primary);
      text-align: center;
      margin-bottom: var(--spacing-md);
    }

    .mission-body {
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: var(--spacing-md);
      color: var(--text);
    }

    .mission-list {
      list-style: none;
      padding: 0;
    }

    .mission-list li {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-sm);
      line-height: 1.6;
      opacity: 0;
      animation: fadeInUp 0.4s ease-out forwards;
    }

    .mission-list li:nth-child(1) { animation-delay: 0.1s; }
    .mission-list li:nth-child(2) { animation-delay: 0.2s; }
    .mission-list li:nth-child(3) { animation-delay: 0.3s; }
    .mission-list li:nth-child(4) { animation-delay: 0.4s; }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .mission-bullet {
      color: var(--primary);
      font-weight: 600;
      flex-shrink: 0;
    }

    .mission-text {
      font-size: 0.95rem;
      color: var(--text);
    }

    .mission-text span {
      color: var(--primary);
      font-weight: 500;
    }

    .tagline {
      margin-top: var(--spacing-lg);
      font-size: 0.92rem;
      color: var(--muted);
      font-style: italic;
      text-align: center;
      line-height: 1.5;
    }

    .footer {
      margin-top: var(--spacing-lg);
      text-align: center;
      font-family: var(--mono);
      font-size: 0.78rem;
      letter-spacing: 0.22em;
      color: var(--muted-dark);
    }

    .footer-main {
      color: var(--primary);
      margin-bottom: 6px;
    }

    .footer-sub {
      letter-spacing: 0.26em;
    }

    .controls {
      margin-top: var(--spacing-md);
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-xs);
    }

    .btn-return {
      font-family: var(--mono);
      font-size: 0.76rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      background: transparent;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 7px 15px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .btn-return::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 0, var(--primary-glow), transparent 60%);
      opacity: 0;
      transition: opacity var(--transition-fast);
      mix-blend-mode: screen;
    }

    /* NOUVEAU: Reflet lumineux mobile */
    .btn-return::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.15),
        transparent
      );
      transition: left 0.6s ease-out;
    }

    .btn-return:hover::after {
      left: 150%;
    }

    .btn-return:hover {
      border-color: var(--primary);
      color: var(--primary);
      box-shadow: 0 0 16px rgba(56, 189, 248, 0.55);
      transform: translateY(-1px);
    }

    .btn-return:hover::before {
      opacity: 1;
    }

    .btn-return:active {
      transform: translateY(0);
    }

    .btn-skip {
      font-family: var(--mono);
      font-size: 0.76rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      background: transparent;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 7px 15px;
      cursor: pointer;
      transition: all var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .btn-skip::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 0, var(--primary-glow), transparent 60%);
      opacity: 0;
      transition: opacity var(--transition-fast);
      mix-blend-mode: screen;
    }

    .btn-skip::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.15),
        transparent
      );
      transition: left 0.6s ease-out;
    }

    .btn-skip:hover::after {
      left: 150%;
    }

    .btn-skip:hover {
      border-color: var(--primary);
      color: var(--primary);
      box-shadow: 0 0 16px rgba(56, 189, 248, 0.55);
    }

    .btn-skip:hover::before {
      opacity: 1;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 640px) {
      .shell {
        margin: 56px auto 40px;
        padding-bottom: 48px;
      }

      .panel-inner {
        padding: 22px 18px 20px;
      }

      .hud-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .title-main {
        letter-spacing: 0.22em;
      }

      .story {
        font-size: 0.88rem;
      }
    }

    .btn-skip.clicked,
    .btn-return.clicked {
      animation: btnClick 0.3s ease-out;
    }

    @keyframes btnClick {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(0.98); }
    }
  </style>
</head>

<body>

<!-- Particules flottantes -->
<div class="particles" id="particles"></div>

<!-- LOADING SCREEN -->
<div class="loading-screen" id="loading-screen">
  <div class="loading-inner">
    <div class="loading-title">INITIALISATION EN COURS</div>
    <div class="loading-logo">READY PLAYER SANTA™ // PROTOCOLE DRCI</div>
    <div class="loading-main">
      Chargement du <span>protocole Santa</span>…<br>
      Mise en ligne de la Mission 1.
    </div>

    <div class="boot-sequence">
      <div class="boot-line">› Authentification DRCI...</div>
      <div class="boot-line">› Chargement mission...</div>
      <div class="boot-line">› Activation paramètres...</div>
    </div>

    <div class="loading-bar">
      <div class="loading-bar-fill" id="loading-fill"></div>
    </div>

    <div class="loading-percent" id="loading-percent">0%</div>

    <div class="loading-hint">
      Conseil : commencez déjà à penser au cadeau que vous aimeriez voir très convoité.
    </div>
  </div>
</div>

<!-- MAIN -->
<main class="shell" id="shell">
  <section class="panel">
    <div class="panel-inner">

      <header class="hud-header">
        <div class="hud-pill">
          <span class="hud-dot"></span>
          <span>TRANSMISSION SÉCURISÉE – SANTA</span>
        </div>
        <div>DRCI · GHICL · 11.12.25</div>
      </header>

      <div class="title">
        <div class="title-main">READY PLAYER SANTA™</div>
        <div class="title-sub">MISSION 1 · PROTOCOLE D'ACTIVATION</div>
      </div>

      <div class="separator"></div>

      <div class="story">
        <span id="story-text"></span><span class="cursor" id="cursor"></span>
      </div>

      <div class="mission-panel" id="mission-panel" style="display:none;">
        <div class="mission-title">MISSION 1 – PARAMÈTRES</div>
        <p class="mission-body">
          Votre première mission est simple, et pourtant déterminante :
        </p>
        <ul class="mission-list">
          <li>
            <div class="mission-bullet">▸</div>
            <div class="mission-text">Trouvez un cadeau d'environ <span>10 €</span></div>
          </li>
          <li>
            <div class="mission-bullet">▸</div>
            <div class="mission-text">Aucun thème imposé</div>
          </li>
          <li>
            <div class="mission-bullet">▸</div>
            <div class="mission-text">Choisissez un objet qui <span>mérite d'être désiré</span></div>
          </li>
          <li>
            <div class="mission-bullet">▸</div>
            <div class="mission-text">
              Un cadeau pour lequel quelqu'un aurait envie de jouer…  
              et peut-être de se battre un peu
            </div>
          </li>
        </ul>
      </div>

      <div class="tagline" id="tagline" style="display:none;">
        Le jeu qui transforme le Secret Santa… pour que chaque cadeau devienne une quête.
      </div>

      <div class="footer" id="footer" style="display:none;">
        <div class="footer-main">READY PLAYER SANTA™</div>
        <div class="footer-sub">NO THEME · ONLY PLAY</div>
      </div>

      <div class="controls">
        <a href="index.html" class="btn-return nav-link"><span>⟵</span> PROTOCOLE S.A.N.T.A</a>
        <button class="btn-skip" id="skip-btn" type="button">⏩ AFFICHER TOUT</button>
      </div>

    </div>
  </section>
</main>

<script>
  // ===== AUDIO FEEDBACK =====
  function playClickSound() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = 800;
    oscillator.type = 'sine';
    
    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
  }

  // ===== PARTICULES INTERACTIVES =====
  function createParticles() {
    const container = document.getElementById('particles');
    const particleCount = 15;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 20 + 's';
      particle.style.animationDuration = (15 + Math.random() * 10) + 's';
      container.appendChild(particle);
    }
  }

  document.addEventListener('mousemove', (e) => {
    const particles = document.querySelectorAll('.particle');
    const mouseX = e.clientX;
    const mouseY = e.clientY;
    
    particles.forEach(particle => {
      const rect = particle.getBoundingClientRect();
      const particleX = rect.left + rect.width / 2;
      const particleY = rect.top + rect.height / 2;
      
      const distance = Math.sqrt(
        Math.pow(mouseX - particleX, 2) + 
        Math.pow(mouseY - particleY, 2)
      );
      
      if (distance < 120) {
        const opacity = 1 - (distance / 120);
        particle.style.opacity = opacity * 0.9;
      }
    });
  });

  createParticles();

  // ===== LOADING =====
  const loadingScreen = document.getElementById("loading-screen");
  const loadingFill = document.getElementById("loading-fill");
  const loadingPercent = document.getElementById("loading-percent");
  const shell = document.getElementById("shell");

  let loadValue = 0;
  const loadInterval = setInterval(() => {
    loadValue += Math.floor(Math.random() * 12) + 4;
    if (loadValue > 100) loadValue = 100;

    loadingFill.style.width = loadValue + "%";
    loadingPercent.textContent = loadValue + "%";

    if (loadValue >= 100) {
      clearInterval(loadInterval);

      setTimeout(() => {
        loadingScreen.style.opacity = "0";
        loadingScreen.style.transition = "opacity 0.6s ease-out";

        setTimeout(() => {
          loadingScreen.style.display = "none";

          // HUD shake activation
          shell.style.animation = "hudShake 0.4s ease";

          shell.classList.add("visible");
          startTypewriter();
        }, 650);
      }, 400);
    }
  }, 180);

  // ===== TYPEWRITER =====
  const storyEl = document.getElementById("story-text");
  const cursorEl = document.getElementById("cursor");
  const missionPanel = document.getElementById("mission-panel");
  const taglineEl = document.getElementById("tagline");
  const footerEl = document.getElementById("footer");
  const skipBtn = document.getElementById("skip-btn");

  const storyText = [
    "> S.A.N.T.A PROTOCOL v1.0",
    "> Domaine : DRCI_GHICL",
    "> Statut : ACTIVÉ",
    "",
    "DRCI,",
    "",
    "L'heure approche.",
    "",
    "Vous avez joué au Secret Santa.",
    "Jusqu'à aujourd'hui.",
    "",
    "Cette année, quelque chose de plus vaste s'est mis en marche.",
    "Un protocole que je n'active que rarement.",
    "Un mode… réservé aux équipes prêtes à relever un défi.",
    "",
    "Je suis Santa.",
    "Et je vous le confirme : tout ne se déroulera pas comme d'habitude.",
    "",
    "Le 11.12.25, un dispositif inédit décidera du destin de vos cadeaux.",
    "Un jeu. Une mécanique. Une série d'épreuves.",
    "Rien d'excessif. Rien de difficile.",
    "Mais suffisamment surprenant pour rendre l'expérience… inoubliable."
  ].join("\n");

  let charIndex = 0;
  let typingSpeed = 26;
  let typeInterval = null;
  let finishedTyping = false;

  function typeStep() {
    if (charIndex < storyText.length) {
      storyEl.textContent += storyText.charAt(charIndex);
      charIndex++;
    } else {
      clearInterval(typeInterval);
      finishedTyping = true;
      showAfterStory();
    }
  }

  function startTypewriter() {
    typeInterval = setInterval(typeStep, typingSpeed);
  }

  function showAfterStory() {
    cursorEl.style.display = "none";
    missionPanel.style.display = "block";

    setTimeout(() => taglineEl.style.display = "block", 250);
    setTimeout(() => footerEl.style.display = "block", 450);
  }

  function showAllNow() {
    clearInterval(typeInterval);
    storyEl.textContent = storyText;
    cursorEl.style.display = "none";
    missionPanel.style.display = "block";
    taglineEl.style.display = "block";
    footerEl.style.display = "block";
    finishedTyping = true;
  }

  skipBtn.addEventListener("click", () => {
    if (!finishedTyping) {
      skipBtn.classList.add('clicked');
      showAllNow();
      try { playClickSound(); } catch (e) {}
    }
  });

  // ===== TRANSITIONS =====
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const href = link.getAttribute('href');
      link.classList.add('clicked');
      try { playClickSound(); } catch (e) {}
      document.body.classList.add('page-exit');
      setTimeout(() => {
        window.location.href = href;
      }, 350);
    });
  });
</script>

</body>
</html>
